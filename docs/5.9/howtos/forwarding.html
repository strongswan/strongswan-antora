<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Forwarding and Split-Tunneling :: strongSwan Documentation</title>
    <link rel="canonical" href="https://docs.strongswan.org/docs/5.9/howtos/forwarding.html">
    <link rel="prev" href="ipsecProtocol.html">
    <link rel="next" href="securityRecommendations.html">
    <meta name="generator" content="Antora 3.0.1">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <link rel="stylesheet" href="../../../_/css/site-extra.css">
    <meta name="google-site-verification" content="pFYsGHXifqmasGBdCNNgzV4OxVDn2d3Zm0DK9WUYCl0" />
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.strongswan.org">strongSwan Documentation</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Sites</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://strongswan.org">strongswan.org</a>
             <a class="navbar-item" href="https://github.com/strongswan/strongswan">Source Repository</a>
            <a class="navbar-item" href="https://github.com/strongswan/strongswan-docs">AsciiDoc Repository</a>
         </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://download.strongswan.org">Downloads</a>
            <a class="navbar-item" href="https://lists.strongswan.org/">Mailing Lists</a>
            <a class="navbar-item" href="https://tnc.strongswan.org">strongTNC</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="docs" data-version="5.9">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">strongSwan Docs</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Installation</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../install/install.html">Installation Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../install/autoconf.html">Autoconf Options</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../install/kernelModules.html">Required Kernel Modules</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../install/reducedPrivileges.html">Reduced Privileges</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../install/trafficDumps.html">Taking Traffic Dumps</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Configuration</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../config/config.html">Configuration Files</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../config/strongswanConf.html">strongswan.conf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../config/strongswanDir.html">strongswan.d Directory</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlConf.html">swanctl.conf</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlDir.html">swanctl Directory</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/IKEv2CipherSuites.html">IKEv2 Cipher Suites</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/logging.html">Logging</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/identityParsing.html">Identity Parsing</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/jobPriority.html">Job Priority Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/lookupTuning.html">Tuning IKE SA Lookup</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/rekeying.html">IKE and IPsec SA Renewal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/retransmission.html">Retransmission</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/tlsOptions.html">TLS Options</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/sqliteDbSchema.html">SQLite Database Schema</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/IPv6Ndp.html">IPv6 and the Neighbor Discovery Protocol</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Features</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/vip.html">Virtual IP Addresses</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/mobike.html">MOBIKE</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/natTraversal.html">NAT Traversal</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/ipcomp.html">IPComp</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/networkManager.html">NetworkManager</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/routeBasedVpn.html">Route-based VPN</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/highAvailability.html">High Availability</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/hashAndUrl.html">Hash and URL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/integrityTests.html">Integrity Tests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../features/ietf.html">IPsec and Related Standards</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Howtos</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../config/quickstart.html">Configuration Quickstart</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../pki/pkiQuickstart.html">Certificates Quickstart</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../pki/caManagement.html">GUI-based CA Management</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="introduction.html">Introduction to strongSwan</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="ipsecProtocol.html">IPsec Protocol</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="forwarding.html">Forwarding and Split-Tunneling</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="securityRecommendations.html">Security Recommendations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="smartcards.html">Smart Card Configuration</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="cloudPlatforms.html">Cloud Platforms</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="nameSpaces.html">strongSwan in Linux Network Namespaces</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Daemons</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../daemons/charon.html">charon</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../daemons/charon-systemd.html">charon-systemd</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../daemons/charon-svc.html">charon-svc</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../daemons/charon-cmd.html">charon-cmd</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">OS</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../os/android.html">Android</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../os/androidVpnClient.html">Android VPN Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../os/androidVpnClientProfiles.html">Android VPN Client Profiles</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../os/androidVpnClientPrivacyPolicy.html">Android VPN Privacy Policy</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../os/androidVpnClientBuild.html">Android VPN Client Build</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../os/windows.html">Windows</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../os/freebsd.html">FreeBSD</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../os/macos.html">macOS</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Interoperability</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../interop/windowsClients.html">Windows Clients</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../interop/windowsCertRequirements.html">Windows Certificate Requirements</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../interop/windowsClients.html#_using_x_509_machine_certificates">Using Machine Certificates</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsMachineCert.html">Storing a Windows Machine Certificate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsMachineConf.html">Windows Client Configuration with Machine Certificates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsMachineConnect.html">Windows Client Connection with Machine Certificates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsMachineServerConf.html">strongSwan Configuration for Windows Machine Certificates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsMachineServerStatus.html">strongSwan Connection Status with Windows Machine Certificates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../interop/windowsClients.html#_using_x_509_user_certificates">Using User Certificates</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsUserCert.html">Storing a Windows User Certificate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsCaCert.html">Storing a Windows CA Certificate</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsUserConf.html">Windows Client Configuration with User Certificates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsUserConnect.html">Windows Client Connection with User Certificates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsUserServerConf.html">strongSwan Configuration for Windows User Certificates</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsUserServerStatus.html">strongSwan Connection Status with Windows User Certificates</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../interop/windowsClients.html#_using_passwords_with_eap_mschapv2">Using EAP</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsEapConf.html">Windows Client EAP Configuration with Passwords</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsEapConnect.html">Windows Client EAP Connection with Passwords</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsEapServerConf.html">strongSwan EAP Configuration with Passwords</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../interop/windowsEapServerStatus.html">strongSwan EAP Connection Status with Passwords</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../interop/microsoftStatusNotify.html">Microsoft Status Notify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../interop/ios.html">iOS and macOS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../interop/appleIkev2Profile.html">Apple IKEv2 Configuration Profile</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../interop/fortinet.html">Fortinet Devices</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Tools</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../swanctl/swanctl.html">swanctl Tool</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlCounters.html">swanctl --counters</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlFlushCerts.html">swanctl --flush-certs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlInitiate.html">swanctl --initiate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlInstall.html">swanctl --install</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlListAlgs.html">swanctl --list-algs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlListAuths.html">swanctl --list-authorities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlListCerts.html">swanctl --list-certs</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlListConns.html">swanctl --list-conns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlListPols.html">swanctl --list-pols</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlListPools.html">swanctl --list-pools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlListSas.html">swanctl --list-sas</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlLoadAll.html">swanctl --load-all</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlLoadAuths.html">swanctl --load-authorities</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlLoadConns.html">swanctl --load-conns</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlLoadCreds.html">swanctl --load-creds</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlLoadPools.html">swanctl --load-pools</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlLog.html">swanctl --log</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlRedirect.html">swanctl --redirect</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlRekey.html">swanctl --rekey</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlReloadSettings.html">swanctl --reload-settings</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlStats.html">swanctl --stats</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlTerminate.html">swanctl --terminate</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlUninstall.html">swanctl --uninstall</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../swanctl/swanctlVersion.html">swanctl --version</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../pki/pki.html">pki Tool</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiAcert.html">pki --acert</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiDn.html">pki --dn</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiEst.html">pki --est</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiEstCa.html">pki --estca</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiGen.html">pki --gen</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiIssue.html">pki --issue</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiKeyid.html">pki --keyid</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiPkcs12.html">pki --pkcs12</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiPkcs7.html">pki --pkcs7</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiPrint.html">pki --print</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiPub.html">pki --pub</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiReq.html">pki --req</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiScep.html">pki --scep</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiScepCa.html">pki --scepca</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiSelf.html">pki --self</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiSignCrl.html">pki --signcrl</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../pki/pkiVerify.html">pki --verify</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tnc/pt-tls-client.html">pt-tls-client Tool</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tnc/sw-collector.html">sw-collector Tool</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tnc/sec-updater.html">sec-updater Tool</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tools/pool.html">ipsec pool Tool</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tnc/attest.html">ipsec attest Tool</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tools/conftest.html">ipsec conftest Tool</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tools/scepclient.html">ipsec scepclient Tool</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Plugins</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../plugins/plugins.html">Plugin List</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/addrblock.html">addrblock Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/attr.html">attr Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/attr-sql.html">attr-sql Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/bypass-lan.html">bypass-lan Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/certexpire.html">certexpire Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/connmark.html">connmark Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/constraints.html">constraints Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/counters.html">counters Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/coupling.html">coupling Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/curl.html">curl Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/dhcp.html">dhcp Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/duplicheck.html">duplicheck Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/eap-dynamic.html">eap-dynamic Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/eap-gtc.html">eap-gtc Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/eap-radius.html">eap-radius Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/eap-simaka-sql.html">eap-simaka-sql Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/eap-tls.html">eap-tls Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/error-notify.html">error-notify Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/ext-auth.html">ext-auth Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/farp.html">farp Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/forecast.html">forecast Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/ha.html">ha Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/kernel-iph.html">kernel-iph Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/kernel-libipsec.html">kernel-libipsec Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/kernel-wfp.html">kernel-wfp Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/load-tester.html">load-tester Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/lookip.html">lookip Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/pkcs11.html">pkcs11 Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/radattr.html">radattr Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/resolve.html">resolve Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/selinux.html">selinux Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/socket-win.html">socket-win Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/sql.html">sql Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/systime-fix.html">systime-fix Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/test-vectors.html">test-vectors Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/tnc-ifmap.html">tnc-ifmap Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/tpm.html">tpm Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/unity.html">unity Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/updown.html">updown Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/vici.html">vici Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/whitelist.html">whitelist Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/winhttp.html">winhttp Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/xauth-eap.html">xauth-eap Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/xauth-noauth.html">xauth-noauth Plugin</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../plugins/xauth-pam.html">xauth-pam Plugin</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../plugins/pluginLoad.html">Plugin Load Options</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Devs</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../devs/devs.html">Developer Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../devs/contributions.html">Contributions</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../devs/programmingStyle.html">Programming Style</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../devs/objectOrientedC.html">Object Oriented C</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../devs/testingEnvironment.html">Testing Environment</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../devs/fuzzing.html">Fuzzing</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Platform Security</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../tpm/tpm2.html">TPM 2.0</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tnc/tnc.html">Trusted Network Connect</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tnc/tncClient.html">TNC Client</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tnc/tncServer.html">TNC Server</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tnc/optimumTncSizes.html">Optimum PB-TNC Batch and PA-TNC Message Sizes</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../tnc/strongTnc.html">strongTNC</a>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tnc/swima.html">Software Inventory</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tnc/swimaClient.html">Software Inventory Client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tnc/swimaServer.html">Software Inventory Server</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tnc/measuredBoot.html">Measured Boot</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tnc/attestationClient.html">Attestation Client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tnc/attestationServer.html">Attestation Server</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tnc/pcrBootEvents.html">PCR Boot Events</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../tnc/ima.html">Integrity Measurement Architecture</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tnc/imaClient.html">IMA Client</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../tnc/imaServer.html">IMA Server</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Support</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../support/helpRequests.html">Help Requests</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../support/faq.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../support/flawReporting.html">Flaw Reporting</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../support/free.html">Free Support</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../support/commercial.html">Commercial Support</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Publications</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../publications/publications.html">Publications and Presentations</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="https://strongswan.org/blog">strongSwan Blog</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">strongSwan Docs</span>
    <span class="version">5.9</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">strongSwan Docs</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">5.9</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">strongSwan Docs</a></li>
    <li>Howtos</li>
    <li><a href="forwarding.html">Forwarding and Split-Tunneling</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/strongswan/strongswan-docs/edit/master/docs/modules/ROOT/pages/howtos/forwarding.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Forwarding and Split-Tunneling</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In remote access situations clients will usually send all their traffic to the
gateway. Below we explain how this traffic can be forwarded and properly routed
back to the roadwarriors.</p>
</div>
<div class="paragraph">
<p>In some situations it might be more desirable to send only specific traffic via
the gateway, for instance, to unburden it from forwarding web or even worse, file
sharing traffic. Therefore, we also explain how to enable so-called <em>split-tunneling</em>
for different clients.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_forwarding_client_traffic"><a class="anchor" href="#_forwarding_client_traffic"></a>Forwarding Client Traffic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to forward traffic to hosts behind the gateway (or hosts on the Internet
if split-tunneling is not used), the following option has to be enabled on Linux
gateways</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sysctl net.ipv4.ip_forward=1
sysctl net.ipv6.conf.all.forwarding=1</pre>
</div>
</div>
<div class="paragraph">
<p>This can be added to <code><strong>/etc/sysctl.conf</strong></code> to enable it permanently.</p>
</div>
<div class="paragraph">
<p>If the firewall on the gateway is rather restrictive, then</p>
</div>
<div class="literalblock">
<div class="content">
<pre>connections.&lt;conn&gt;.children.&lt;child&gt;.updown = /usr/libexec/ipsec/_updown iptables</pre>
</div>
</div>
<div class="paragraph">
<p>will automatically cause the default <a href="../plugins/updown.html" class="xref page"><code><strong>_updown</strong></code></a> script
to add rules that allow traffic to be forwarded.</p>
</div>
<div class="paragraph">
<p>In remote access setups, VPN clients will be assigned a
<a href="../features/vip.html" class="xref page">virtual IP</a> address from a configured address pool. The
important thing on the gateway side is that all hosts to which the gateway forwards
traffic to, have to know that they must route packets to be tunneled back to the
remote access clients via the VPN gateway.</p>
</div>
<div class="paragraph">
<p>Please note that there might be additional considerations when hosting on
<a href="cloudPlatforms.html" class="xref page">cloud platforms</a> (e.g. src/dst address checks).</p>
</div>
<div class="sect2">
<h3 id="_hosts_on_the_lan"><a class="anchor" href="#_hosts_on_the_lan"></a>Hosts on the LAN</h3>
<div class="paragraph">
<p>For hosts on the LAN behind the gateway the following situations are possible:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">The virtual IPs are from the subnet behind the gateway </dt>
<dd>
<p>In this situation either the <a href="../plugins/dhcp.html" class="xref page"><code><strong>dhcp</strong></code></a> plugin is used or
the gateway assigns <a href="../features/vip.html" class="xref page">virtual IP</a> addresses from a subnet
of the whole LAN behind the gateway (distinct from the IP addresses assigned via
DHCP to other LAN hosts). If that is the case, the <a href="../plugins/farp.html" class="xref page"><code><strong>farp</strong></code></a>
plugin must be used so that the hosts behind the gateway may learn that they have
to send response packets to the VPN gateway. For IPv6 something similar can be
done using Neighbour Discovery Protocol (NDP) proxying.</p>
</dd>
<dt class="hdlist1">The virtual IPs are from a distinct subnet / In site-to-site scenarios </dt>
<dd>
<p>If the VPN gateway is the <strong>default gateway</strong> of the accessed LAN nothing special
has to be done.  If this is not the case, either add a route on all hosts behind
the gateway (manually or e.g. via <a href="https://datatracker.ietf.org/doc/html/rfc3442">DHCP option 121</a>), telling them that
the subnet from which virtual IP addresses are assigned to roadwarriors or remote
subnets in <strong>site-to-site</strong> scenarios can be reached through the VPN gateway.</p>
<div class="paragraph">
<p>Alternatively configure a static route on the actual default gateway that redirects
traffic for the virtual subnet to the VPN gateway. It&#8217;s also possible to NAT the
virtual IPs to the (internal) IP address of the gateway, so that requests from
remote clients will look to LAN hosts as if they originated from the gateway (see
the next section for notes on setting up a NAT).</p>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If the VPN gateway is not the default gateway of the LAN, ICMP redirects might get
returned to hosts if they send traffic destined for the remote hosts/subnets to the
VPN gateway, directing them to the default gateway of the LAN (which probably doesn&#8217;t
work and otherwise might get that traffic out unencrypted). To avoid this, disable
sending such ICMP messages by setting</p>
</div>
<div class="listingblock">
<div class="content">
<pre>net.ipv4.conf.all.send_redirects=0
net.ipv4.conf.default.send_redirects=0</pre>
</div>
</div>
<div class="paragraph">
<p>If the latter option is not set before the network interface comes up, also set
the option for the individual interface</p>
</div>
<div class="listingblock">
<div class="content">
<pre>net.ipv4.conf.&lt;iface&gt;.send_redirects=0</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_hosts_on_the_internet"><a class="anchor" href="#_hosts_on_the_internet"></a>Hosts on the Internet</h3>
<div class="paragraph">
<p>If <strong>split-tunneling</strong> is not used, all client traffic will be sent through the IPsec
tunnel. In this scenario '<strong>local_ts = 0.0.0.0/0</strong>` is configured on the gateway and
<code><strong>remote_ts = 0.0.0.0/0</strong></code> on the client.  Now, the gateway could simply ignore
or drop traffic not destined for subnets it doesn&#8217;t want the clients to access.
But that is probably not what most users expect.  It is more likely that they
expect being able to continue to surf the web or read their emails while being
connected to the VPN.</p>
</div>
<div class="paragraph">
<p>The situation here is similar to the one for LAN hosts above. If the gateway would
simply forward traffic from the virtual subnet to hosts on the Internet, these hosts
wouldn&#8217;t be able respond because they would send their response to the virtual IP
address. What is therefore required are <strong>NAT rules</strong> so that hosts in the virtual
subnet are mapped to at least one IP address of the VPN gateway (which itself could
be behind a NAT device too). For hosts on the Internet, traffic from the virtual
subnet then would appear to originate from the VPN gateway.</p>
</div>
<div class="paragraph">
<p>By way of example, let&#8217;s assume the gateway assigns virtual IPs from the
<code><strong>10.0.3.0/24</strong></code> subnet to its roadwarrior clients. The following <code><strong>iptables</strong></code> rules
will NAT traffic from that subnet to the gateway&#8217;s <code><strong>eth0</strong></code> interface (this works
even for gateways that have only one network interface).</p>
</div>
<div class="listingblock">
<div class="content">
<pre>iptables -t nat -A POSTROUTING -s 10.0.3.0/24 -o eth0 -m policy --dir out --pol ipsec -j ACCEPT
iptables -t nat -A POSTROUTING -s 10.0.3.0/24 -o eth0 -j MASQUERADE</pre>
</div>
</div>
<div class="paragraph">
<p>The first rule exempts traffic that matches an IPsec policy from the NAT rule.
Additional subnets behind the gateway may be listed after <code><strong>-s</strong></code>, like
<code><strong>-s 10.0.3.0/24,192.168.88.0/24</strong></code>. The <code><strong>-s</strong></code> option may also be omitted altogether
to match all outbound traffic.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_general_nat_problems"><a class="anchor" href="#_general_nat_problems"></a>General NAT problems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Local firewall stacks generally don&#8217;t treat packets with a matching IPsec policy
any different from unprotected packets. That means NAT rules also apply to traffic
that is supposed to be tunneled.</p>
</div>
<div class="paragraph">
<p>This often leads to problems, because many hosts have <code>SNAT</code> or <code>MASQUERADE</code> rules
set up which change the source IP of the packets, making them not match the negotiated
IPsec policies when IPsec processing of outgoing packets happens in the
<a href="https://upload.wikimedia.org/wikipedia/commons/3/37/Netfilter-packet-flow.svg">Netfilter packet flow</a> <code><strong>xfrm lookup</strong></code> node. To fix this problem, packets
with a matching IPsec policy should skip NAT rules in the <code>POSTROUTING</code> chain of
the <code><strong>nat</strong></code> table. This is achieved by inserting a rule that accepts packets with
a matching IPsec policy before any NAT rule in the <code>POSTROUTING</code> chain</p>
</div>
<div class="listingblock">
<div class="content">
<pre>iptables -t nat -I POSTROUTING -m policy --pol ipsec --dir out -j ACCEPT</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_split_tunneling"><a class="anchor" href="#_split_tunneling"></a>Split-Tunneling</h2>
<div class="sectionbody">
<div class="paragraph">
<p>With split-tunneling the clients will only send traffic for specific destination
subnets to the gateway. For both protocol versions split-tunneling is easy to deploy
f traffic selectors (TS) can freely be configured on both peers. In that case you&#8217;d
simply use specific values for the <code><strong>local_ts</strong></code> and <code><strong>remote_ts</strong></code> options.</p>
</div>
<div class="sect2">
<h3 id="_split_tunneling_with_ikev2"><a class="anchor" href="#_split_tunneling_with_ikev2"></a>Split-Tunneling with IKEv2</h3>
<div class="paragraph">
<p>With IKEv2, <strong>split-tunneling</strong> is quite easy to use as the protocol inherently
supports the narrowing of the proposed traffic selectors.</p>
</div>
<div class="paragraph">
<p>For instance if the client proposes <code><strong>0.0.0.0/0</strong></code> as a remote traffic selector, i.e.
(<code><strong>remote_ts = 0.0.0.0/0</strong></code>), this proposal can be narrowed on the gateway by
configuring <code><strong>local_ts =</strong> &lt;list of subnets&gt;</code>. Likewise the client may already propose
a selective remote TS by configuring a list of subnets with <code><strong>remote_ts</strong></code> which the
gateway might simply accept (e.g. if it has configured <code><strong>local_ts = 0.0.0.0/0</strong></code>)
or could further narrow the subnets to be tunneled.</p>
</div>
<div class="paragraph">
<p>While the protocol supports split-tunneling, whether it can actually be used
<strong>depends on the client</strong>. Most remote access clients will propose <code><strong>0.0.0.0/0</strong></code> as
remote TS, so split-tunneling must be configured explicitly on the gateway. But
whether this will actually result in split-tunneling will depend on the client.
All strongSwan based clients (Linux, NetworkManager, Android) support this kind
of narrowing whereas for Windows clients the situation is as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Windows 7 </dt>
<dd>
<p>The client will always allow access to the host&#8217;s LAN. So to access e.g. a local
printer nothing special has to be done. Since the client always proposes <code><strong>0.0.0.0/0</strong></code>
as remote TS, the gateway is free to narrow it to a subset. But to make split-tunneling
actually work on the client, the <em>Use default gateway on remote network</em> option
in the <em>Advanced TCP/IP</em> settings of the VPN connection has to be disabled. Also
because a classful route is installed, the virtual IP address has to belong to the
remote subnet, otherwise the <em>Disable class based route addition</em> option has to
be enabled and routes have to be installed manually.</p>
</dd>
<dt class="hdlist1">Windows 8.1 and Windows Server 2012 R2 </dt>
<dd>
<p>Microsoft introduced <a href="https://docs.microsoft.com/en-us/powershell/module/vpnclient/">PowerShell cmdlets</a> to configure VPN connections.
These provide more options and also allow to configure split tunneling directly
(<code><strong>-SplitTunneling</strong></code> option).</p>
</dd>
<dt class="hdlist1">Windows 10 </dt>
<dd>
<p>Split tunneling is enabled by default but with the same limitations seen since
Windows 7, i.e. the virtual IP has to be from the remote subnet or routes have
to be added manually, e.g. via the
<a href="https://docs.microsoft.com/en-us/powershell/module/vpnclient//Add-VpnConnectionRoute?view=win10-ps">Add-VpnConnectionRoute</a> PowerShell
command. To tunnel all traffic via VPN instead, split tunneling has to be disabled
explicitly, either by enabling the <em>Use default gateway on remote network</em>
setting described above or by using the following PowerShell command</p>
<div class="listingblock">
<div class="content">
<pre>Set-VpnConnection "&lt;Connection Name&gt;" -SplitTunneling 0</pre>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_split_tunneling_with_ikev1"><a class="anchor" href="#_split_tunneling_with_ikev1"></a>Split-Tunneling with IKEv1</h3>
<div class="paragraph">
<p>IKEv1 does not provide narrowing of traffic selectors by default.  That means that
the traffic selector configuration usually has to <strong>match exactly</strong> on both peers.
To simplify things, the IKEv1 implementation in the
<a href="../daemons/charon.html" class="xref page"><code><strong>charon</strong></code></a> daemon does support <strong>narrowing</strong> of traffic
selectors similar to how it is implemented for IKEv2. Unfortunately this is not
compatible with many third party implementations.</p>
</div>
<div class="paragraph">
<p>On the other hand, such clients may support the <strong>Unity extensions</strong> developed by
Cisco. The <a href="../plugins/unity.html" class="xref page"><code><strong>unity</strong></code></a> plugin provides strongSwan gateways
with a transparent way of assigning narrowed traffic selectors to clients that
support these extensions (e.g. <code><strong>racoon</strong></code> as used in Apple products). The
<a href="../plugins/attr.html" class="xref page"><code><strong>attr</strong></code></a> and <a href="../plugins/attr-sql.html" class="xref page"><code><strong>attr-sql</strong></code></a> plugins
provides the means to manually configure attributes that enable split-tunneling
for Unity-aware clients.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mtumss_issues"><a class="anchor" href="#_mtumss_issues"></a>MTU/MSS Issues</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is possible that you encounter MSS/MTU problems when tunneling traffic. This is
caused by broken routers dropping ICMP packets and thus breaking PMTUD (Path MTU
Discovery). You can work around these issues by lowering the advertised MSS value
of TCP with the <code>TCPMSS</code> target in <code><strong>iptables</strong></code>.</p>
</div>
<div class="paragraph">
<p>Or if you control the router in question, fixing PMTU may be advisable. To do so
you need to permit the appropriate ICMP traffic (type 3, destination unreachable,
code 4, fragmentation needed - though all of type 3 is usually allowed).
In particular one must pay attention to the source address of ICMP messages emitted
by the VPN gateway, which will usually be the primary IP address of the gateway&#8217;s
internal interface, <strong>not</strong> that of the endpoint experiencing the issue.</p>
</div>
<div class="paragraph">
<p>The value you set with the <code>TCPMSS</code> target must accommodate for any other overhead
introduced by the tunneling protocols in use (e.g. UDP encapsulation of ESP).
Google the issue and read the man page of <code><strong>iptables</strong></code> and <code><strong>iptables-extensions</strong></code>
if there are any questions about its usage.</p>
</div>
<div class="paragraph">
<p>The <code><strong>charon.plugins.kernel-netlink.mss</strong></code> and <code><strong>charon.plugins.kernel-netlink.mtu</strong></code>
options may be used, too, but the values set there apply to the routes that
the <code><strong>kernel-netlink</strong></code> plugin installs and the impact of them onto the traffic and
the behavior of the kernel is currently quite unclear.</p>
</div>
<div class="paragraph">
<p>Add the following <code><strong>iptables</strong></code> rules on the IKE responder to reduce the MSS (as
noted above, the actual values depend on the overhead imposed by the tunneling
protocols and the MTU, so it might have to be lower than what is used in the
example here):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>iptables -t mangle -A FORWARD -m policy --pol ipsec --dir in  -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1361:1536 -j TCPMSS --set-mss 1360
iptables -t mangle -A FORWARD -m policy --pol ipsec --dir out -p tcp -m tcp --tcp-flags SYN,RST SYN -m tcpmss --mss 1361:1536 -j TCPMSS --set-mss 1360</pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can add the same rules in <code>PREROUTING</code> and <code>POSTROUTING</code>
(also in the <code><strong>mangle</strong></code> table). Additionally set <code><strong>net.ipv4.ip_no_pmtu_disc=1</strong></code>
on the server.</p>
</div>
<div class="paragraph">
<p>In newer kernels the counter <code><strong>XfrmOutStateModeError</strong></code> in <code><strong>/proc/self/net/xfrm_stat</strong></code>
is incremented if the kernel detects that a packet would be too large after
encapsulation.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="ipsecProtocol.html">IPsec Protocol</a></span>
  <span class="next"><a href="securityRecommendations.html">Security Recommendations</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <a href="https://www.strongswan.org/"> 
     <img src="../../../_/img/strongswan.png" alt="strongSwan Logo" height="100"
        width="153" style="vertical-align:middle;float:left;margin:0px 20px"></a>
  <p>Copyright &copy; 2021-2022
     <a href="mailto:info@.strongswan.org">The strongSwan Team</a> and individual contributors.
     The <a href="https://github.com/strongswan/strongswan-docs">content</a>
     is provided under a <a href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> license<p>
  <p>The <a href="https://github.com/strongswan/strongswan-antora">UI</a>
     for this site is derived from the Antora default UI and is licensed under
     the <a href="https://www.mozilla.org/en-US/MPL/2.0/">MPL-2.0</a> license.</p>
 </footer>

<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
<script src="../../../_/js/vendor/lunr.js"></script>
<script src="../../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../../.." data-snippet-length="100" data-stylesheet="../../../_/css/search.css"></script>
<script async src="../../../search-index.js"></script>
  </body>
</html>
